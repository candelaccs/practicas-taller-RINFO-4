programa ejercicio1practica4 
procesos 
  proceso servidorFlores
  comenzar
    mientras HayFlorEnLaEsquina
      tomarFlor
  fin
  proceso juntarFlores (E flores: numero) 
  comenzar 
    repetir flores {no puedo asegurar que esa esquina no tenia flores antes} 
      tomarFlor 
  fin 
  proceso dejandoFlores (E flores: numero) 
  comenzar 
    mientras (HayFlorEnLaBolsa & PosCa < 100) { en este caso deberia suponer que NO hay flor en la bolsa?} 
      mover 
      depositarFlor 
  fin 
  proceso quienEs (E id: numero; ES flores: numero) 
  comenzar 
    si (id = 1) 
      RecibirMensaje (flores, robot1) 
    sino 
      si (id = 2) 
        RecibirMensaje (flores, robot2) 
      sino 
        si (id = 3) 
          RecibirMensaje (flores, robot3) 
  fin 
  proceso recibirAvCa (E id: numero; ES av: numero; ES ca: numero) 
  comenzar 
    si (id = 1) 
      RecibirMensaje (av, robot1) 
      RecibirMensaje (ca, robot1) 
    sino 
      si (id = 2) 
        RecibirMensaje (av, robot2) 
        RecibirMensaje (ca, robot2) 
      sino 
        si (id = 3) 
          RecibirMensaje (av, robot3) 
          RecibirMensaje (ca, robot3) 
  fin 
  proceso enviarACK (E id: numero) 
  comenzar 
    si (id = 1) 
      EnviarMensaje (V, robot1) 
    sino 
      si (id=2) 
        EnviarMensaje (V, robot2) 
      sino 
        si ( id = 3) 
          EnviarMensaje (V, robot3) 
  fin 
areas 
  areaS: AreaP (100,100,100,100) 
  area1: AreaPC (1,1,1,100) 
  area2: AreaPC (2,1,2,100) 
  area3: AreaPC (3,1,3,100) 
robots 
  robot servidor
  variables 
    flores, id, contador, av, ca: numero 
  comenzar 
    servidorFlores
    contador:=0  
    mientras (contador < 3) 
      RecibirMensaje (id, *) 
      quienEs (id, flores) 
      si (flores <>0) 
        recibirAvCa (id, av, ca)
        Pos (av,ca) 
        dejarFlores (flores) 
        enviarACK (id)
      sino 
        contador:= contador+1 
  fin         
  robot cliente1 
  variables 
    flores, id: numero 
    ok: boolean 
  comenzar 
    mientras (PosCa < 100) 
      Random (flores, 1,4) 
      EnviarMensaje (1, servidor) 
      EnviarMensaje (flores,servidor) 
      EnviarMensaje (PosAv, servidor) 
      EnviarMensaje (PosCa+1, servidor) 
      RecibirMensaje (ok, servidor) 
      Pos (PosAv, PosCa+1) 
      juntarFlores (flores)
      Pos (PosAv, PosCa) 
      dejandoFlores (flores)
    EnviarMensaje (0, servidor)
  fin 
  robot cliente2 
  variables 
    flores, id: numero 
    ok: boolean 
  comenzar 
    mientras (PosCa < 100) 
      Random (flores, 1,4) 
      EnviarMensaje (2, servidor) 
      EnviarMensaje (flores, servidor) 
      EnviarMensaje (PosAv, servidor) 
      EnviarMensaje (PosCa+1, servidor)
      RecibirMensaje (ok, servidor) 
      Pos (PosAv, PosCa+1) 
      juntarFlores (flores)
      Pos (PosAv, PosCa)
      dejandoFlores (flores) 
    EnviarMensaje (0, servidor) 
  fin 
  robot cliente3
  variables 
    flores, id: numero 
    ok: boolean 
  comenzar  
    mientras (PosCa < 100) 
      Random (flores, 1,4) 
      EnviarMensaje (3, servidor) 
      EnviarMensaje (flores, servidor) 
      EnviarMensaje (PosAv, servidor) 
      EnviarMensaje (PosCa+1, servidor) 
      RecibirMensaje (ok, servidor) 
      Pos (PosAv, PosCa+1) 
      juntarFlores (flores)
      Pos (PosAv, PosCa)
      dejandoFlores (flores) 
    EnviarMensaje (0, servidor) 
  fin 
variables 
  servidor: servidor 
  robot1: cliente1
  robot2: cliente2
  robot3: cliente3
comenzar
  AsignarArea (servidor, areaS) 
  AsignarArea (servidor, area1) 
  AsignarArea (servidor, area2) 
  AsignarArea (servidor, area3) 
  AsignarArea (robot1, area1) 
  AsignarArea (robot2, area2)
  AsignarArea (robot3, area3)
  Iniciar (servidor, 100,100) 
  Iniciar (robot1, 1,1) 
  Iniciar (robot2,2,1)
  Iniciar (robot3,3,1)
fin 
